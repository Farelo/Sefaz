<div class="">
  <h2 translate="REGISTER.CONTROL_POINT.REGISTER_TITLE"></h2>
  <hr>

  <form novalidate (ngSubmit)="onSubmit(mControlPoint)" [formGroup]="mControlPoint" #formDir="ngForm">
    <div class="row">

      <!-- Input para o nome do ponto de controle -->
      <div class="campo col-md-12"> 
        <p translate="REGISTER.CONTROL_POINT.NAME" class="descricao"></p>
        <p translate="REGISTER.CONTROL_POINT.NAME_DESC" class="explicacao"></p>
        <div class="input-group">
          <input type="text" 
            class="form-control" 
            maxlength="50"
            placeholder="{{ 'REGISTER.CONTROL_POINT.NAME_PLACEHOLDER' | translate }}" 
            aria-describedby="basic-addon2"
            formControlName="name"
            (focusout)="validateName($event)"
            [ngClass]="{'required': (mControlPoint.get('name').hasError('required') && mControlPoint.get('name').touched)
              || (mControlPoint.get('name').hasError('required') && submitted)
              || (mControlPoint.get('name').hasError('pattern')) 
              || (mControlPoint.get('name').hasError('pattern') && submitted)
              || (mControlPoint.get('name').hasError('minlength'))
              || (mControlPoint.get('name').hasError('minlength') && submitted)
              || (mControlPoint.get('name').hasError('uniqueValidation'))
              || (mControlPoint.get('name').hasError('uniqueValidation') && submitted)}">
        </div>

        <p translate="REGISTER.ERRORS.REQUIRED" class="requiredText" *ngIf="(mControlPoint.get('name').hasError('required') && mControlPoint.get('name').touched)
          || (mControlPoint.get('name').hasError('required') && formDir.submitted)"> </p>
        
        <p translate="REGISTER.ERRORS.MIN_5" class="requiredText" *ngIf="(mControlPoint.get('name').hasError('minlength'))
          || (mControlPoint.get('name').hasError('minlength') && formDir.submitted)"> </p>

        <p translate="REGISTER.ERRORS.CHECKING" class="explicacao" *ngIf="validateNotTakenLoading"> </p>
          
        <p translate="REGISTER.ERRORS.CP_EXISTS" class="requiredText" *ngIf="(mControlPoint.get('name').hasError('uniqueValidation')) 
          || (mControlPoint.get('name').hasError('uniqueValidation') && submitted)"> </p>
          
        <p translate="REGISTER.ERRORS.WHITE_SPACE" class="requiredText" 
          *ngIf="(mControlPoint.get('name').hasError('pattern')) || (mControlPoint.get('name').hasError('pattern') && submitted)"></p>
      </div>

      <!-- Input para o duns do ponto de controle -->
      <div class="campo col-md-12 col-md-6">
        <p translate="REGISTER.CONTROL_POINT.DUNS" class="descricao"></p>
        <p translate="REGISTER.CONTROL_POINT.DUNS_DESC" class="explicacao"></p>
        <div class="input-group">

          <input type="text" 
            class="form-control" 
            maxlength="30"
            placeholder="{{ 'REGISTER.CONTROL_POINT.DUNS_PLACEHOLDER' | translate }}" 
            aria-describedby="basic-addon2"
            formControlName="duns" 
            [ngClass]="{'required': (mControlPoint.get('duns').hasError('required') && mControlPoint.get('duns').touched)
              || (mControlPoint.get('duns').hasError('required') && submitted)}">
        </div>

        <p translate="REGISTER.ERRORS.REQUIRED" class="requiredText" *ngIf="(mControlPoint.get('duns').hasError('required') && mControlPoint.get('duns').touched)
                    || (mControlPoint.get('duns').hasError('required') && submitted)"> </p>
      </div>

      <!-- Input para o tipo do ponto de controle -->
      <div class="campo col-sm-12 col-md-6">
        <p translate="REGISTER.CONTROL_POINT.TYPE" class="descricao"></p>
        <ng-select bindLabel="name" 
          placeholder="{{ 'REGISTER.CONTROL_POINT.TYPE_PLACEHOLDER' | translate }}" 
          [items]="allTypes" 
          [addTag]="true" 
          (add)="onAddItem($event)"
          formControlName="type">
          <ng-template ng-option-tmp let-item="item">
            {{item.name}}
          </ng-template>
        </ng-select>
        
        <p translate="REGISTER.ERRORS.REQUIRED" class="requiredText" *ngIf="(mControlPoint.get('type').hasError('required') && mControlPoint.get('type').touched)
          || (mControlPoint.get('type').hasError('required') && submitted)"> </p>

        <p translate="REGISTER.ERRORS.MIN_5" class="requiredText" *ngIf="(mControlPoint.get('type').hasError('minlength') && mControlPoint.get('type').touched)
          || (mControlPoint.get('type').hasError('minlength') && submitted)"> </p>

        <p translate="REGISTER.ERRORS.MAX_50" class="requiredText" *ngIf="(mControlPoint.get('type').hasError('maxlength') && mControlPoint.get('type').touched)
          || (mControlPoint.get('type').hasError('maxlength') && submitted)"> </p>
      </div>

      <!-- Input para selecionar a empresa vinculada -->
      <div class="campo col-sm-12 col-md-6">
        <p translate="REGISTER.CONTROL_POINT.LINK" class="descricao"></p>

        <ng-select bindLabel="name" placeholder="{{ 'REGISTER.CONTROL_POINT.LINK_PLACEHOLDER' | translate }}" [items]="allCompanies" formControlName="company">
          <ng-template ng-option-tmp let-item="item">
            <div> {{item.name}} </div>
          </ng-template>
        </ng-select>

        <p translate="REGISTER.ERRORS.REQUIRED" class="requiredText" *ngIf="(mControlPoint.get('company').hasError('required') && mControlPoint.get('company').touched)
            || (mControlPoint.get('company').hasError('required') && mControlPoint.invalid && submitted)"> </p>
      </div>


      <!-- Input para digitar o endereço -->
      <div class="col-sm-12" style="margin-bottom: 10px;">
        <p translate="REGISTER.CONTROL_POINT.SITE" class="descricao"></p>

        <input places-auto-complete 
          class="form-control"
          (place_changed)="placeChanged($event)" 
          [types]="['geocode']" 
          formControlName="full_address"
          placeholder="{{ 'REGISTER.CONTROL_POINT.SITE_PLACEHOLDER' | translate }}" 
          [ngClass]="{'required': (mControlPoint.get('full_address').hasError('required') && mControlPoint.get('full_address').touched)
            || (mControlPoint.get('full_address').hasError('required') && mControlPoint.invalid && submitted)}"/>

          <p translate="REGISTER.ERRORS.REQUIRED" class="descricao" class="requiredText" *ngIf="(mControlPoint.get('full_address').hasError('required') && mControlPoint.get('full_address').touched)
            || (mControlPoint.get('full_address').hasError('required') && mControlPoint.invalid && submitted)"> </p>

          <!-- (click)="onClick($event)" -->
          <ngui-map 
            [zoom]="zoom" 
            [center]="center"   
            style="height: 600px; margin-top: 10px;" > 
            <drawing-manager 
              [drawingControl]="true" 
              [drawingControlOptions]="{
                position: 2,
                drawingModes: ['circle', 'polygon']}"
              [polygonOptions]="{
                fillColor: '#0044a8',
                fillOpacity: 0.2,
                strokeColor: '#0044a8',
                strokeWeight: 1,
                strokeOpacity: '0.4',
                editable: true,
                zIndex: 1}"
              [circleOptions]="{
                fillColor: '#0044a8',
                fillOpacity: 0.2,
                strokeColor: '#0044a8',
                strokeWeight: 1,
                strokeOpacity: '0.4',
                editable: true,
                zIndex: 1}"></drawing-manager>

                <!-- ///////////// -->
                <!-- Ponto de Controle -->
                <marker *ngFor="let posCP of listOfCircleControlPoints" 
                  [position]="posCP.position" 
                  [icon]="{ url: 'assets/images/pin_plant.png', size: [28, 43], scaledSize: [28, 43] }"
                  [title]="posCP.name" (click)="clickedPlant($event, posCP)">

                  <info-window id="pw">
                    <div translate="REGISTER.CONTROL_POINT.INFO" class="iw-title"></div>
                    <div *ngIf="plant.display" class="info-window-content">
                      <p><span class="bold">{{ 'REGISTER.CONTROL_POINT.CONTROL_POINT' | translate }}:</span> {{ plant.name }}</p>
                    </div>
                  </info-window>
                </marker>
                
                <circle *ngFor="let posCPCircle of listOfCircleControlPoints" 
                  [center]="posCPCircle.geofence.coordinates[0]" 
                  [radius]="posCPCircle.geofence.radius"
                  [editable]="false" 
                  [fillColor]="'#546E7A'" 
                  [fillOpacity]="0.2" 
                  [strokeColor]="'#37474F'" 
                  [strokeOpacity]="0.4"
                  [strokeWeight]="1"> </circle>
                
                <!-- ///////////// -->
                <!-- Ponto de Controle -->
                <marker *ngFor="let posCP of listOfPolygonControlPoints" [position]="posCP.position" (click)="clickedPlant($event, posCP)"
                  [icon]="{ url: 'assets/images/pin_plant.png', size: [28, 43], scaledSize: [28, 43] }">
                  <!-- <div class="custom-icon-map-plant"></div> -->
                  <info-window id="lw">
                    <div translate="REGISTER.CONTROL_POINT.INFO" class="iw-title"></div>
                    <div *ngIf="plant.display" class="info-window-content">
                      <p><span class="bold">{{ 'REGISTER.CONTROL_POINT.CONTROL_POINT' | translate }}:</span> {{ plant.name }}</p>
                    </div>
                  </info-window>
                </marker>
                
                <polygon *ngFor="let posCPPolygon of listOfPolygonControlPoints" 
                  [paths]="posCPPolygon.geofence.coordinates" 
                  [editable]="false"
                  [fillColor]="'#546E7A'" 
                  [fillOpacity]="0.2" 
                  [strokeColor]="'#37474F'" 
                  [strokeOpacity]="0.4" 
                  [strokeWeight]="1"> </polygon>

          </ngui-map>

          <p translate="REGISTER.CONTROL_POINT.SELECT_EDGES" 
            class="requiredText" 
            *ngIf="(mControlPoint.get('full_address').value !== '' && mControlPoint.get('full_address').touched 
              && !pointWasSelected)"></p>
            <div *ngIf="mGeofence?.radius">{{ 'REGISTER.CONTROL_POINT.RADIUS' | translate }}: {{ mGeofence.radius }} </div>
      </div>

      <div class="campo col-sm-12 informacoes">
        <div class="bigger2">
          <div class="fromSun"></div>
        </div>
        <div class="forn">{{ this.mControlPoint.controls.full_address.value || 'REGISTER.CONTROL_POINT.NO_INFORMATION' | translate}}</div>
      </div>


      <!-- Input para a latitude -->
      <!-- <div class="campo col-md-6">
        <p class="descricao">LATITUDE</p>
        <div class="input-group">
          <input type="text" 
            readonly
            class="form-control" 
            placeholder="Digite a latitude" 
            aria-describedby="basic-addon2"
            formControlName="lat" 
            [(ngModel)]="lat" 
            [ngClass]="{'required': (mControlPoint.get('lat').hasError('required') && mControlPoint.get('lat').touched)
              || (mControlPoint.get('lat').hasError('required') && submitted)}">
        </div>

        <p class="requiredText" *ngIf="(mControlPoint.get('lat').hasError('required') && mControlPoint.get('lat').touched)
          || (mControlPoint.get('lat').hasError('required') && submitted)">
          Campo Obrigatório</p>
      </div> -->


      <!-- Input para a longitude -->
      <!-- <div class="campo col-md-6">
        <p class="descricao">LONGITUDE</p>
        <div class="input-group">
          <input type="text" 
            readonly
            class="form-control" 
            placeholder="Digite a longitude" 
            aria-describedby="basic-addon2"
            formControlName="lng" 
            [(ngModel)]="lng" 
            [ngClass]="{'required': (mControlPoint.get('lng').hasError('required') && mControlPoint.get('lng').touched)
            || (mControlPoint.get('lng').hasError('required') && submitted)}">
        </div>

        <p class="requiredText" *ngIf="(mControlPoint.get('lng').hasError('required') && mControlPoint.get('lng').touched)
          || (mControlPoint.get('lng').hasError('required') && submitted)">
          Campo Obrigatório</p>
      </div> -->
    </div>

    <br />

    <div class="botoes">
      <button translate="REGISTER.BACK_BUTTON" routerLink="/rc/cadastros/ponto" class="botaoVoltar"></button>
      <button translate="REGISTER.REGISTER_BUTTON" type="submit" class="botaoRegistrar"></button>
    </div>

    <br />

  </form>
</div>