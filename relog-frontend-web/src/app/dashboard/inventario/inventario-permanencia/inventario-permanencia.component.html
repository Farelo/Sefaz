<div class="base-bg">
  <h3>Tempo de Permanência</h3>
  <br>

  <!-- Linha divisória -->
  <hr style="margin-top: 10px;">

  <div class="row" style="margin-bottom: 20px;">
    <div class="col-sm-4">
      <p>FAMÍLIA</p>
      <ng-select 
        [items]="listOfFamilies"
        [(ngModel)]="selectedFamily" 
        (change)="familyFilter($event)" 
        bindLabel="code"  
        placeholder="Selecione uma Família">
        
        <ng-template ng-label-tmp let-item="item">
          {{item.code}}
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div> {{item.code}} </div>
        </ng-template>

      </ng-select>
    </div>
    
    <!--TEMPO DE PERMANÊNCIA: filtro Serial -->
    <div class="col-sm-4 clear-padding">
      <p>SERIAL</p>
      <ng-select 
        [items]="listOfSerials"
        [(ngModel)]="selectedSerial" 
        (change)="serialFilter($event)" 
        [disabled]="!selectedFamily"
        bindLabel="serial"
        bindValue="serial"
        placeholder="Selecione um Serial">
        
        <ng-template ng-label-tmp let-item="item">
          {{item.serial}}
        </ng-template>

        <ng-template ng-option-tmp let-item="item">
          <div> {{item.serial}} </div>
        </ng-template>

      </ng-select>
    </div>
  </div>

  <!-- Taela SEM serial selecionado -->
  <div>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr class="cabecalho">
            <th>Equipamento</th>
            <th>Serial</th>
            <th>Tag</th>

            <th>Planta Atual</th>
            <th>Local</th>
            <th>Tempo na Planta</th>

            <!-- <th>DUNS</th>
            <th>Fornecedor</th> -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of listOfPermanence | paginate: {
                                                      id:'permanence',
                                                      itemsPerPage: 10,
                                                      currentPage: actualPage,
                                                      totalItems: listOfPermanence.length}">
            <td>{{ item.family_code || '-' }}</td>
            <td>{{ item.serial || '-' }}</td>
            <td>{{ item.tag?.code || '-' }}</td>

            <td>{{ item.current_control_point_name }}</td>
            <td>{{ item.current_control_point_type }}</td>
            <td>{{ item.permanence_time_exceeded | float_time }}</td>

            <!-- <td>{{ item.supplier?.duns || '-' }}</td>
            <td>{{ item.supplier?.name || '-' }}</td> -->
          </tr>
        </tbody>
      </table>

      <div class="classVazio" *ngIf="listOfPermanence.length < 1">
        Selecione um equipamento.
      </div>
    </div>

    <br>
    
    <div class="has-text-centered">
      <pagination-controls class="my-pagination" id="permanence" (pageChange)="actualPage = $event;" directionLinks="false" autoHide="true">
      </pagination-controls>
    </div>
  </div>

  <!-- Taela COM serial selecionado -->
  <!-- <div *ngIf="selectedSerial">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr class="cabecalho">
            <th>Data</th>
            <th>Hora</th>
            <th>Duns</th>

            <th>Fornecedor</th>
            <th>Status</th>
            <th>Local</th>

            <th>Tempo no Status</th>
            <th style="text-align: center;">Tempo de Referência <br> BPline (Dias)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let packing of permanence.data | paginate: {
                                                            id: 'permanenceHistoric',
                                                            itemsPerPage: 10,
                                                            currentPage: permanence.meta.page,
                                                            totalItems: permanence.meta.total_docs}">
            <td>{{ packing.date | date: 'dd/MM/yyyy' }}</td>
            <td>{{ packing.date | date:'HH:MM:ss' }}</td>
            <td>{{ packing.supplier?.duns || '-' }}</td>

            <td>{{ packing.supplier?.name || '-' }}</td>
            <td>{{ packing.status == 'NORMAL' || packing.status == undefined? packing.plant?.plant.plant_name : (packing.status
              == 'MISSING' ? 'Embalagem Ausente' : 'Embalagem Viajando') }}</td>
            <td>{{ packing.plant | type }}</td>

            <td>{{ packing.permanence_time >= 0 ? (packing.permanence_time | time) : 'Sem Registro' }}</td>
            <td style="text-align: center;">{{ packing.actual_gc16?.days >= 0 ? packing.actual_gc16?.days : '-' }}</td>
          </tr>
        </tbody>
      </table>

      <div class="classVazio" *ngIf="permanence.data?.length < 1">
        Não existem embalagens cadastradas com estes parâmetros.
      </div>
    </div>

    <br> 

    <div class="has-text-centered">
      <pagination-controls class="my-pagination" id="permanenceHistoric" (pageChange)="permanence.meta.page = $event;permanenceInventorySerial()"
        directionLinks="false" autoHide="true">
      </pagination-controls>
    </div>
  </div> -->

</div>

<br>