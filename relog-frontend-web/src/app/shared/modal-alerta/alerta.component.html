<div class="modalFilho">
  <div class="header">

    <h2>Detalhes do Alerta</h2>

    <button type="button" class="close" aria-label="Close" (click)="activeAlerta.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>

    <div class="col-xs-12 no-padding tags-row">
      <p style="float: left;">
        <span class="badge badge-secondary">Código: {{alerta.data.packing?.code}}</span>
        <span class="badge badge-secondary" style="margin-left:5px;">Serial: {{alerta.data.packing?.serial}}</span>
        <span class="badge badge-secondary" style="margin-left:5px;">TAG: {{alerta.data.packing?.code_tag}}</span>
      </p>

      <img id="ver-no-mapa" (click)="visualizeOnMap()" tooltip="Visualizar no mapa" placement="left" src="assets/images/distancia.png"
        height="25" style="float: right;">
    </div>

    <p>Momento do alerta: {{alerta.data.date | date: 'dd/MM/yy HH:mm:ss'}} </p>

    <p>Tipo:
      <span>{{alerta.data.status === 1 ? 'Embalagem ausente' : (alerta.data.status === 2 ? 'Local Incorreto' : (alerta.data.status
        === 3 ? 'Bateria Baixa' : (alerta.data.status === 4 ? 'Embalagam Atrasada' : 'Tempo de Permanência Elevado')))}}</span>
    </p>
  </div>


  <div class="modalBody" *ngIf="alerta.data.status === 1">
    <p>
      <span>Ultima Planta que foi visto:</span> {{alerta.data.actual_plant ? alerta.data.actual_plant.plant.plant_name : 'Sem Registro'}}</p>
    <p>
      <span>Ultimo departamento visto:</span> {{alerta.data.department ? alerta.data.department?.name : 'Sem Registro'}}</p>
    <p>
      <span>Tempo de ausência:</span> {{alerta.data.packing?.packing_missing?.time_countdown >= 0 ? (alerta.data.packing?.packing_missing?.time_countdown
      | time) : 'Sem Registro'}}</p>
    <div class="divBotao">
      <button type="button" class="botaoVisualizar" (click)="getHistoric();historicFlag = true" *ngIf="!historicFlag">Visualizar Historico</button>
      <button type="button" class="botaoVisualizar" (click)="historicFlag = false" *ngIf="historicFlag">Fechar Historico</button>
      <br>
      <div style="padding-top: 20px" class="table-responsive tabela" *ngIf="historicFlag">
        <table class="table">
          <thead>
            <tr class="cabecalho">
              <th>Data</th>
              <th>Hora</th>
              <th>Fornecedor</th>
              <th>Local</th>
              <th>Tempo no status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let packing of historic.data | paginate: {
                                                            id: 'historic',
                                                            itemsPerPage: 10,
                                                            currentPage: historic.meta.page,
                                                            totalItems: historic.meta.total_docs}">
              <td>{{ packing.date | date: 'dd/MM/yy' }}</td>
              <td>{{ packing.date | date: 'HH:mm:ss'}}</td>
              <td>{{ packing.supplier?.name || '-' }}</td>
              <td>{{ packing.status }}</td>
              <td>{{ packing.permanence_time >= 0 ? (packing.permanence_time | time) : 'Sem Registro' }}</td>
            </tr>

          </tbody>
        </table>
        <div class="has-text-centered">
          <pagination-controls id='historic' class="my-pagination" (pageChange)="historic.meta.page = $event;getHistoric()" directionLinks="false"
            autoHide="true">
          </pagination-controls>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBody" *ngIf="alerta.data.status === 2 ">
    <p>
      <span>Planta Atual:</span> {{alerta.data.actual_plant ? alerta.data.actual_plant.plant.plant_name : 'Sem Registro'}}</p>
    <p>
      <span>Departamento:</span> {{alerta.data.department ? alerta.data.department.name : 'Sem Registro'}}</p>

    <div class="table-responsive tabela">
      <table class="table">
        <thead>
          <tr class="cabecalho">
            <th colspan="5" class="text-center"> Rotas da embalagem </th>
          </tr>
          <tr class="cabecalho">
            <th class="semBorda">Fornecedor</th>
            <th class="semBorda">Planta da Fábrica</th>
            <th class="semBorda">Planta do Fornecedor</th>
            <th class="semBorda">Tempo Min.</th>
            <th class="semBorda">Tempo Max.</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let route of alerta.data.routes">
            <td>{{route.supplier.name}}</td>
            <td>{{route.plant_factory.plant_name}}</td>
            <td>{{route.plant_supplier.plant_name}}</td>
            <td>{{route.time.min | time}}</td>
            <td>{{route.time.max | time}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modalBody" *ngIf="alerta.data.status === 3">

    <p>
      <span>Nivel da Bateria:</span> {{alerta.data?.packing?.battery >=0 ? (alerta.data?.packing?.battery | round) : 'Sem Registro'}}%</p>
    <p>
      <span>Departamento:</span> {{alerta.data.actual_plant ? (alerta.data.department ? alerta.data.department.name : 'Sem Registro')
      : 'Sem Registro'}}</p>
    <p>
      <span>Planta Atual:</span> {{alerta.data.actual_plant ? alerta.data.actual_plant.plant.plant_name : 'Sem Registro'}}</p>

  </div>

  <div class="modalBody" *ngIf="alerta.data.status === 4">

    <p>
      <span>Tempo em viagem:</span> {{alerta.data.packing?.trip.time_countdown | time }}</p>
    <div class="table-responsive tabela">
      <table class="table">
        <thead>
          <tr class="cabecalho">

            <th class="semBorda">Planta da Fábrica</th>
            <th class="semBorda">Planta do Fornecedor</th>
            <th class="semBorda">Tempo Máximo</th>
            <th class="semBorda">Tempo Gasto</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let route of alerta.data.routes">

            <td>{{route.plant_factory.plant_name}}</td>
            <td>{{route.plant_supplier.plant_name}}</td>
            <td>{{route.time.max | time}}</td>
            <td>{{alerta.data.packing?.trip.time_countdown | time }}</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <div class="modalBody" *ngIf="alerta.data.status === 5">

    <p>
      <span>Permanência Excedido em:</span> {{alerta.data?.packing.permanence.date_exceeded >= 0 ? (alerta.data?.packing.permanence.date_exceeded
      | date: 'dd/MM/yy HH:mm:ss'): 'Sem Registro' }}</p>
    <p>
      <span>Permanência Atual:</span> {{alerta.data?.packing.permanence.amount_days_exceeded >= 0 ? (alerta.data?.packing.permanence.amount_days_exceeded
      | time ): 'Sem Registro' }}</p>
    <p>
      <span>Planta Atual:</span> {{alerta.data.actual_plant ? alerta.data.actual_plant.plant.plant_name : 'Sem Registro'}}</p>
    <p>
      <span>Data de Entrada:</span> {{alerta.data?.packing.permanence.date >= 0 ? (alerta.data?.packing.permanence?.date | date)
      : 'Sem Registro'}}</p>
    <p>
      <span>Ultimo departamento visto:</span> {{alerta.data.department ? alerta.data.department?.name : 'Sem Registro'}}</p>

  </div>

  <!-- <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="activeAlerta.close('Close click')">Close</button>
</div> -->
</div>