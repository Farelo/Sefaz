upstream cebrace {

    # server do relog-cebrace e sua porta correspondente
    server  cebrace-frontend-web:8010;
}

server {
    #escuta na porta 80 http, vindo da internet     
    listen 80;

    #pelos dominios abaixo
    server_name relogtechnology.com relogtechnology.com.br;

    #retorna uma nova url encriptada para ser, em seguida, escutada pela porta 443
    #aqui, toda entrada via dominio .com ou .com.br retorna apenas o dominio .com
    return 301 https://relogtechnology.com$request_uri;
}

server {
     
     #escuta na porta 443
     listen 443 ssl;
     
     #pelo domninio abaixo
     server_name relogtechnology.com;
     
     ssl_certificate /etc/letsencrypt/live/relogtechnology.com/fullchain.pem;
     ssl_certificate_key /etc/letsencrypt/live/relogtechnology.com/privkey.pem;
     ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
     ssl_prefer_server_ciphers on;
     ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
     
     root /usr/share/nginx/html;
     
     index index.html index.htm;

     # Make site accessible from http://localhost/ -> acessivel de dentro desta maquina hospedeira
     server_name localhost;
     
     #quando a url nao tem subdiretorios
     location /cebrace {
        #   proxy_pass http://172.17.0.3:3000;
          proxy_pass http://cebrace;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "upgrade";
          proxy_set_header Host $http_host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forward-Proto http;
          proxy_set_header X-Nginx-Proxy true;
          proxy_redirect off;
     }

}