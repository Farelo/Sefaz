<div class="base">
  <h1>REGISTRAR ROTA</h1>
  <br />
  <form novalidate (ngSubmit)="onSubmit(route)" [formGroup]="route" #formDir="ngForm">
    <div class="row">
      <div class="col-md-12">
        <alert type="info" *ngIf="!existPacking">
          <strong>Atenção!</strong> Não existe embalagens associadas a esse fornecedor.
        </alert>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">

        <div class="campo">
          <p class="descricao">ASSOCIE UM FORNECEDOR</p>
          <p class="explicacao"></p>
          <select  formControlName="supplier" (ngModelChange)="loadPackings($event)"
          [ngClass]="{'required': (route.get('supplier').hasError('required') && route.get('supplier').touched)
            || (route.get('supplier').hasError('required') && formDir.submitted)}">
           <option value="">Associe um Fornecedor </option>
           <option *ngFor="let obj of suppliers?.data" [ngValue]="obj">DUNS: {{obj.duns}} - Nome: {{obj.name}}</option>
          </select>
          <p class="requiredText" *ngIf="(route.get('supplier').hasError('required') && route.get('supplier').touched)
        || (route.get('supplier').hasError('required') && formDir.submitted)">Campo Obrigatório</p>
        </div>

        <div class="campo" [hidden]="!choiced">
          <p class="descricao">ASSOCIE A EMBALAGEM</p>
          <p class="explicacao"></p>
          <select (ngModelChange)="onChangePacking($event)" formControlName="packing_code">
            <option value="">Associe uma embalagem</option>
          <option *ngFor="let obj of packings" [ngValue]="obj" >Código: {{obj.id}} - Projeto: {{obj.project.name}} </option>
        </select>
        </div>

        <div class="campo" [hidden]="!choice_equipament">
          <p class="descricao">FORNECEDOR DA EMBALAGEM</p>
          <div class="input-group">
            <input class="form-control" aria-describedby="basic-addon2" [value]="route['controls'].supplier.value.name ? route['controls'].supplier.value.name : ''" disabled />
          </div>
        </div>

        <div class="campo" [hidden]="!choice_equipament">
          <p class="descricao">PLANTA DO FORNECEDOR </p>
          <div class="input-group">
            <input class="form-control" aria-describedby="basic-addon2" [value]="route['controls'].plant_supplier.value.plant_name ? route['controls'].plant_supplier.value.plant_name : ''" disabled/>
          </div>
        </div>
      </div>


      <div class="col-md-6" [hidden]="!choice_equipament">
        <div class="campo">
          <p class="descricao">ASSOCIE A PLANTA DA FABRICA</p>
          <p class="explicacao"></p>
          <select id="planta" (ngModelChange)="onChangeFactory($event)" formControlName="plant_factory" [ngClass]="{'required': (route.get('plant_factory').hasError('required') && route.get('plant_factory').touched)
        || (route.get('plant_factory').hasError('required') && formDir.submitted)}">
            <option value="">Associe uma Planta</option>
          <option *ngFor="let obj of plants?.data" [ngValue]="obj" >{{obj.plant_name}}</option>
        </select>
          <p class="requiredText" *ngIf="(route.get('plant_factory').hasError('required') && route.get('plant_factory').touched)
        || (route.get('plant_factory').hasError('required') && formDir.submitted)">Campo Obrigatório</p>
        </div>

        <div class="campo" formGroupName="time">
          <p class="descricao">DEFINA UM TEMPO MÁXIMO DE VIAGEM</p>
          <p class="explicacao"></p>
          <div class="col-md-6">
            <ngb-timepicker [(ngModel)]="time_max" [seconds]="true" formControlName="max"></ngb-timepicker>
            <!-- <timepicker [(ngModel)]="max" formControlName="max"></timepicker> -->
            <p class="requiredText" *ngIf="(route.get('time.max').hasError('required') && route.get('time.max').touched)
          || (route.get('time.max').hasError('required') && formDir.submitted)">Campo Obrigatório</p>
          </div>
          <div class="col-md-6">
            <p>Dias: {{time_max.hour}}</p>
            <p>Horas: {{time_max.minute }}</p>
            <p>Minutos: {{time_max.second }}</p>
          </div>

        </div>

        <div class="campo" formGroupName="time">
          <p class="descricao">DEFINA UM TEMPO MÍNIMO DE VIAGEM</p>
          <p class="explicacao"></p>
          <div class="col-md-6">
            <ngb-timepicker [(ngModel)]="time_min" [seconds]="true" formControlName="min"></ngb-timepicker>
            <!-- <timepicker [(ngModel)]="min" formControlName="min"></timepicker> -->
            <p class="requiredText" *ngIf="(route.get('time.min').hasError('required') && route.get('time.min').touched)
          || (route.get('time.min').hasError('required') && formDir.submitted)">Campo Obrigatório</p>
          </div>
          <div class="col-md-6">
            <p>Dias: {{time_min.hour}}</p>
            <p>Horas: {{time_min.minute }}</p>
            <p>Minutos: {{time_min.second }}</p>
          </div>

        </div>
      </div>

    </div>
    <hr class="divisoria" *ngIf="directions">
    <div class="row" *ngIf="directions" style="margin-top: 0px;">
      <div class="col-sm-6 informacoes">
        <div class="bigger2">
          <div class="fromSun"></div>
        </div>
        <span class="forn">{{route['controls'].location['controls'].start_address.value}}</span>
      </div>

      <div class="col-sm-6 informacoes">
        <div class="bigger2">
          <div class="fromSun"></div>
        </div>
        <span class="forn">{{route['controls'].location['controls'].end_address.value}}</span>
      </div>
    </div>
    <div class="row" *ngIf="directions" style="margin-top: 0px;">
      <div class="col-sm-6 informacoes">
        <div class="bigger2">
          <div class="fromSun"></div>
        </div>
        <span class="forn">{{route['controls'].location['controls'].distance['controls'].text.value}}</span>
      </div>

      <!-- <div class="col-sm-6 informacoes">
            <div class="bigger2">
              <div class="fromSun"></div>
            </div>
            <span class="forn">{{route['controls'].location['controls'].duration['controls'].text.value}}</span>
          </div> -->
    </div>

    <div class="row">
      <!-- <div class="col-md-12" *ngIf="directions">
      <p>{{this.route.location | json}}</p>
    </div> -->
      <div class="col-md-12">
        <br>
        <ngui-map zoom="13" [center]="center">
          <directions-renderer [suppressMarkers]="false" [draggable]="true" panel="#my-panel" (directions_changed)="directionsChanged()" [directions-request]="direction">
          </directions-renderer>
        </ngui-map>
      </div>
    </div>
    <!-- MAP TO DIRECRTIONS -->

    <br />
    <div class="botoes">
      <button routerLink="/rc/cadastros/rotas" class="botaoVoltar">VOLTAR</button>
      <button type="submit" class="botaoRegistrar">REGISTRAR</button>
    </div>
    <Br />
  </form>
</div>
