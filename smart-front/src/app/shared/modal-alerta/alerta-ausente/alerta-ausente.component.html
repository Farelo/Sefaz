<div class="modalFilho">
  <div class="header">

    <h1>Embalagem Ausente</h1>

    <div class="col-xs-12 no-padding tags-row">
      <p class="alerta-badges">
        <span class="badge badge-secondary">Código: {{alerta.data.packing?.code}}</span>
        <span class="badge badge-secondary" style="margin-left:5px;">Serial: {{alerta.data.packing?.serial}}</span>
        <span class="badge badge-secondary" style="margin-left:5px;">TAG: {{alerta.data.packing?.code_tag}}</span>
      </p>

      <img 
        id="ver-no-mapa" 
        (click)="visualizeOnMap()" 
        tooltip="Visualizar no mapa" 
        placement="left" 
        src="../../../assets/images/distancia.png"
        height="25" style="float: right;">
    </div>

    <button type="button" class="close" aria-label="Close" (click)="activeAlerta.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modalBody" *ngIf="alerta.data.status === 1">
    <p class="titulo-modal">EMITIDO EM:</p> <br>
    <label> {{alerta.data.date | date: 'dd/MM/yy'}} | {{alerta.data.date | date:'HH:MM:ss'}} </label>
    
    <p>Tipo:
      <span>{{alerta.data.status === 1 ? 'Embalagem ausente' : (alerta.data.status === 2 ? 'Local Incorreto' : (alerta.data.status
        === 3 ? 'Bateria Baixa' : (alerta.data.status === 4 ? 'Embalagam Atrasada' : 'Tempo de Permanência Elevado')))}}</span>
    </p>

    <p>
      <span>Ultima Planta que foi visto:</span> {{alerta.data.actual_plant ? alerta.data.actual_plant.plant.plant_name : 'Sem Registro'}}</p>
    <p>
      <span>Ultimo departamento visto:</span> {{alerta.data.department ? alerta.data.department?.name : 'Sem Registro'}}</p>
    <p>
      <span>Tempo de ausência:</span> {{alerta.data.packing?.packing_missing?.time_countdown >= 0 ? (alerta.data.packing?.packing_missing?.time_countdown
      | time) : 'Sem Registro'}}</p>
    <div class="divBotao">
      <button type="button" class="botaoVisualizar" (click)="getHistoric();historicFlag = true" *ngIf="!historicFlag">Visualizar Historico</button>
      <button type="button" class="botaoVisualizar" (click)="historicFlag = false" *ngIf="historicFlag">Fechar Historico</button>
      <br>
      <div style="padding-top: 20px" class="table-responsive tabela" *ngIf="historicFlag">
        <table class="table">
          <thead>
            <tr class="cabecalho">
              <th>Data</th>
              <th>Hora</th>
              <th>Fornecedor</th>
              <th>Local</th>
              <th>Tempo no status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let packing of historic.data | paginate: {
                                                              id: 'historic',
                                                              itemsPerPage: 10,
                                                              currentPage: historic.meta.page,
                                                              totalItems: historic.meta.total_docs}">
              <td>{{ packing.date | date: 'dd/MM/yyyy' }}</td>
              <td>{{ packing.date | date: 'HH:MM:ss' }}</td>
              <td>{{ packing.supplier?.name || '-' }}</td>
              <td>{{ packing.status }}</td>
              <td>{{ packing.permanence_time >= 0 ? (packing.permanence_time | time) : 'Sem Registro' }}</td>
            </tr>
  
          </tbody>
        </table>
        <div class="has-text-centered">
          <pagination-controls id='historic' class="my-pagination" (pageChange)="historic.meta.page = $event;getHistoric()" directionLinks="false"
            autoHide="true">
          </pagination-controls>
        </div>
      </div>
    </div>
  </div>
</div>